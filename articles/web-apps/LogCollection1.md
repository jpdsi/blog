---
title: IIS の調査に必要な基本的なログ情報について
date: 2020-01-14
tags: 
  - Internet Information Services
  - ログ採取
---

こんにちは。IIS サポート チームです！
 

弊社にお問い合わせいただくお客様に、スムーズな解決をご提供するためにお役に立てるのではないかということで、今回の記事の執筆に至っています。

さて、IIS 上でのトラブル シューティングをスムーズにするためには、ログをご提供いただき、すぐに IIS の構成や生じている問題を把握することが重要です。
場合によっては、ログを見て、即日で解決というケースもあります。

お問い合わせいただいた後、これらの把握のために複数のログを採取いただくようお願いしておりますが、今回の記事で、その採取方法についてご紹介いたします！
この手順にて採取した情報を、お問い合わせと同時に弊社にご提供いただければよりスムーズなご支援をお約束いたします！
 
現象により採取するべきログは異なりますが、ほとんどの現象の調査に対して有効なログ 4 つの採取方法を以下にご紹介いたします。

 
1. **イベント ログ**
2. **IIS ログ**
3. **IIS の構成ファイル**
4. **HTTPERR ログ**

 
また、ログをご提供いただきましたら、まずは現象発生時刻周辺を確認するため、ログのご提供と同時に、以下を併せてお知らせいただけますと嬉しいです！


- **現象発生時刻（時分秒）**
- **現象が発生する URL**
- **現象発生時の画面キャプチャ**
- **アプリ内で発生した例外の抜粋**

---------------

## 1. イベント ログ 
イベント ログはイベント ビューアーの起動が必要なため、以下の手順で採取ください。
 
1. Windows Server 上にてイベント ビューアーを起動します（コマンド: eventvwr）
2. [Windows ログ] を展開します
3. 以下をそれぞれ右クリックし、[すべてのイベントを名前をつけて保存] を選択します    
 
- Application（アプリケーション）
- システム
- セキュリティ

4. 任意の名前を入力し、.evtx および .txt 形式で保存します。

   ![step](./LogCollection1/step.png)
 

## 2. IIS ログ
IIS ログは、既定で以下のフォルダーに u_exYYMMDD.log として保存されます。
 

　　%SystemDrive%\inetpub\logs\LogFiles\W3SVCn (n はサイト識別子) 
 

サイト識別子は、インターネット サービス マネージャーの左側ペインから [サイト] を選択し、[機能ビュー] の [ID] 列にて確認できます。

   ![Reference](./LogCollection1/reference.png)


対象となるサイトの ID を把握できましたら、現象を再現させた状態で、管理者権限のコマンド プロンプトで以下のコマンドを実行の上、現象発生日時を含む IIS ログをコピーしてご提供ください。
 

　　netsh http flush logbuffer
 

なお、ログは UTC 時間で記録されますので、日本時間はログに記載の日時に +9 時間となります。
 


## 3. IIS の構成ファイル
IIS の構成情報は %SystemRoot%\system32\inetsrv\config\applicationHost.config、および、各アプリケーションの物理ディレクトリ以下にある web.config に保存されています。

 
applicationHost.config および web.config をコピーしてご提供ください。

 
※固有の設定がない場合には、web.config は存在しない可能性もございます
　web.config が存在する場合は、その格納パスもお知らせください


 

## 4. HTTPERR ログ
HTTPERR ログは %SystemRoot%\system32\LogFiles\HTTPERR フォルダー配下に保存されます。
[更新日時] が、現象発生日時の前後１日を含んでいる HTTPERR ログをコピーしてご提供ください。
 
例えば、現象が発生したのが 2019/11/11 の場合は、[更新日時] が 2019/11/10, 2019/11/12 と表示されているものをご提供ください。
 
なお、HTTPERR ログに記録される時刻は UTC となり、日本時間はログに記載の日時に +9 時間となります。


今回は以上です。
それでは、また次回！
